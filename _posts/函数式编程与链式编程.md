# 函数式编程（functional programming  fp）

## 定义

"函数式编程"是一种["编程范式"](http://en.wikipedia.org/wiki/Programming_paradigm)（programming paradigm）

> 编程是为了解决问题，而解决问题可以有多种视角和思路，其中具有普适性的模式被归结为范式。 `面向对象`、`面向过程`都是编程范式。

它属于["结构化编程"](http://en.wikipedia.org/wiki/Structured_programming)的一种，主要思想是把运算过程尽量写成一系列嵌套的函数调用

```
	// 数学表达式
（1 + 2） * 3 - 4

	// 传统的过程式编程写法
 var a = 1 + 2; 
 var b = a * 3; 
 var c = b - 4;
 
  // 函数式写法
  // 函数式编程要求使用函数，将运算过程定义为不同的函数
 var result = subtract(multiply(add(1,2), 3), 4);
```



## 特点

五个特点

**1.函数是“第一等公民”**

> 函数与其他类型一样，处于公平地位，可赋值给其他变量，也可以作为参数传入到另一个函数，或者作为别的函数的返回值

```
var print = function(i){ console.log(i);};
[1,2,3].forEach(print);
```



**2.闭包和高阶函数**

闭包：返回作用域

高阶函数：接受一个或多个函数作为参数，也将函数返回作为输出



**3. 不修改状态(由此延伸出”引用透明”的概念)**

不会修改变量，在其他类型的语言中，变量往往用来保存"状态"（state）。不修改变量，意味着状态不能保存在变量中。函数式编程使用参数保存状态，最好的例子就是递归

**引用透明**

函数的运行不依赖于外部的状态，只依赖传入的参数，任何时候只要传入的参数相同，得到的结果就是相同的

> 避免使用程序状态和可变对象，是降低程序复杂度的有效方式之一，而这也正是函数式编程的精髓。函数式编程强调执行的结果，而非执行的过程。我们先构建一系列简单却具有一定功能的小函数，然后再将这些函数进行组装以实现完整的逻辑和复杂的运算，这是函数式编程的基本思想



**4.递归**

函数式编程用递归做为控制流程的机制。



**5.只用"表达式"，不用"语句"，没有副作用**

"表达式"（expression）是一个单纯的运算过程，总是有返回值；"语句"（statement）是执行某种操作，没有返回值。函数式编程要求，只使用表达式，不使用语句。每一步（单子 monad）都是单纯的运算，而且都有返回值。

>原因是函数式编程的开发动机，一开始就是为了处理运算（computation），不考虑系统的读写（I/O）。"语句"属于对系统的读写操作，所以就被排斥在外。
>
>当然，实际应用中，不做I/O是不可能的。因此，编程过程中，函数式编程只要求把I/O限制到最小，不要有不必要的读写行为，保持计算过程的单纯性。
>
>["副作用"](http://en.wikipedia.org/wiki/Side_effect_(computer_science))（side effect），指的是函数内部与外部互动，产生运算以外的其他结果。函数要保持独立，所有功能就是返回一个新的值，没有其他行为，尤其是不得修改外部变量的值。



## 意义

**1.代码简洁，开发快速**

> 大量使用函数，减少代码重复

**2.接近自然语言，易于理解**

> 自由度高，更容易编写出自然语言的代码
>
> ```a
> merge([1,2][3,4]).sort().find(2)
> ```

**3.方便代码管理**

> 不依赖也不改变外部状态，只要给定参数就会输出结果，每一个函数都能看做独立单元，利于进行单元测试与debug和模块化组合

**4.线程安全**

>因为不会修改外部变量的值，所以不用担心线程安全问题

**5.代码热升级**

>没有副作用，只要保证接口不变，内部实现于外部无关，可以在运行状态下直接升级代码，不需要重启



# 各种函数的定义

### 纯函数

**定义：**

> 1.相同的输入必定产生相同的输出
>
> 2.在计算过程中不会产生副作用

纯函数让我们对写出的函数具有完全的控制能力。纯函数的结果 **必须** 只依赖于输入参数，不受外部环境的影响；同时纯函数在计算结果的过程中，也不会影响（污染）外部环境，即不会产生副作用。

**函数组合**

> 纯函数定义中的两个条件保证了它（的计算过程）与外界是完全隔离，这也是函数组合的基础。
>
> 只有函数组合中的所有函数都是纯函数，我们组合起来的新函数才会是纯函数。我们可以对使用纯函数组合出来的新函数从数学上证明（推导）其正确性，而无需借助大量的单元测试。
>
> 只要在函数组合时引入一个非纯函数，整个组合出来的函数将沦为非纯函数。如果将函数组合比作管道的拼接，只要组成管道的任何一小节有泄露或者外部注入，我们便失去了对整条管道的完全控制。

**引用透明及缓存**

> *如果一段代码可以替换成它执行所得的结果，而且是在不改变整个程序行为的前提下替换的，那么我们就说这段代码是引用透明的。*(两个条件，一是一段代码直接替换成结果，二是不改变程序行为。)
>
> 执行一段引用透明的代码（函数），对于相同的参数，总是给出相同的结果。我们也称这样的函数（代码）为纯函数
>
> 引用透明的一个典型应用即函数缓存，可以将已经执行过的函数输出值缓存，如果下次执行时参数相同则直接返回缓存

**也就是说纯函数的调用在相同参数下的返回值第二次不需要计算**



### 一等函数（First Class Functions

**定义：**

> 程序语言会对基本元素的使用方式进行限制，带有最少限制的元素被称为一等公民，其拥有的 “权利” 如下
>
> - 可以使用变量命名；
> - 可以提供给函数作为参数；
> - 可以由函数作为结果返回；
> - 可以包含在数据结构中；



### 高阶函数

**定义：**

> 使用函数作为输入参数，或者返回值为函数的函数，被称为高阶函数。



### 闭包

**定义：**

> 闭包是由函数及该函数捕获的其上下文中的自由变量组成的记录



**本质上，函数式编程只是范畴论的运算方法，跟数理逻辑、微积分、行列式是同一类东西，都是数学方法，只是碰巧它能用来写程序**

>为什么函数式编程要求函数必须是纯的，不能有副作用？因为它是一种数学运算，原始目的就是求值，不做其他事情，否则就无法满足函数运算法则了。



# 链式编程

## 概述

将多个操作（多行代码）通过点号（.）链接在一起成为一句代码，使代码可读性好。



## 特点

**方法返回block回调，block返回对象本身**

**多个操作（函数）以点(.)连成链，形成链式表达**



# 两者的对比

**函数式编程的返回值是经过处理的参数，而链式编程的返回值是自身，函数式编程不会修改外部状态，而链式编程会修改上下文的状态**

